# 课程集群使用说明

课程为同学们提供了实验集群来完成作业，并用于进行最终的测试和评分。你 **可以** 不在集群上完成作业，但 **必须** 保证提交的版本能在课程集群上正常地编译和运行，否则可能导致无法得到任何作业分数。所有的正确性和性能测试，都以课程集群的运行结果为准。

## 访问方式

集群的登录节点 `conv0` 可供 SSH 访问，通过下发的用户名（ics-学号）和初始密码登录到 `166.111.68.163` 的 `22222` 端口即可。在校内和校外都可直接访问，无需使用代理或者 VPN。如果使用终端，命令类似 `ssh -p 22222 ics-2019000000@166.111.68.163`。如果使用客户端，注意不要忘记配置端口和用户名。

### 注意密码安全

    初始密码是随机生成的，比较难记。你可以使用 `passwd` 命令更改登陆密码。为了保证安全，我们在集群上配置了密码复杂性策略：新密码必须至少 12 位长、不能包含用户名、不能包含连续的重复字符、不能包含连续的序列（如 1234）。

### IP 封禁

    为了防止暴力破解，单个 IP 在三次登录失败后，将会被登录节点封禁 10 分钟。封禁期间，登录集群可能会遭遇连接超时问题，请稍后再试。  

为了简化过程和增强安全性，强烈推荐配置公钥进行 SSH 登录，你可以自行搜索相关的教程。如果需要使用集群上的图形化工具，需要保证本地有正在运行的 X server，并在连接时启用 SSH 的 X11 Forwarding 功能，即使用 `ssh -X` 登录集群。

### 禁止分享账号

    禁止以任何形式将自己的账号分享给任何其他同学（无论是否选课）使用，包括且不限于提供密码、私钥等。一经发现，涉及的选课同学所有作业成绩无效。

## 文件编辑

学生在集群上的 home 目录形如 `/home/course/ics/users/2020000000`。你应当 **在且仅在** 此目录下放置作业文件。

### 注意权限
    
    默认情况下，所有学生账号属于同一个组（`ics-lab`），但 home 目录仅允许自己和助教访问（默认权限为 `770`）。**严格禁止** 更改自己 home 目录的权限，以防其他人访问你的 home 目录。如果发现故意的此类行为，视同分享账号处理。

集群上安装了 VIM、Emacs、nano 等文本编辑器，你可以自由选取使用。也可以在本地编写代码并推送到集群上测试，推荐使用 Git 来进行文件的同步和追踪，或者使用 `rsync` 只进行同步。此外，为了防止由于网络原因造成的进度丢失、程序终止等问题，推荐在登录 SSH 后使用 `screen` 或 `tmux` 来进行终端复用。本文档中不会详细介绍这些工具，建议同学们自行查阅学习，亦可询问助教。

### 不推荐在集群上编辑

    虽然 VSCode Remote SSH / JetBrains Remote Development 允许直接在集群上在线编辑，方便易用。但由于选课同学较多，这些工具的服务端进程可能给服务器带来较大的负载， **显著影响使用体验** 。此外，直接在集群上编辑还存在集群损坏导致的 **文件丢失风险** 。因此推荐在本地编辑，使用集群进行调试。

    如果你依旧选择在集群上编辑，说明你已经阅读并知悉了上述内容，并且 **不会就这些问题向教学团队提出质疑** 。

为了防止误操作，集群的 home 使用 ZFS 配置了自动的快照备份。每个用户的 home 都是单独的 ZFS dataset，可以通过访问 `~/.zfs/snapshot/` 下各个文件夹的方式获取快照时间点时存在的的文件，文件夹名称即为快照时间。如果需要，也可以请求助教直接将整个 home 回滚到某个当前存在的快照对应的时间点。注意快照是 **只读的** ，并且在一段时间后会自动删除。请 **自行备份** 重要的文件，对于任何误操作导致的后果，包括且不限于作业丢失无法找回等，教学团队概不负责。

## 资源限制

### 禁止滥用

    除了上述已经声明的事项，在使用集群时，以下行为也是 **严格禁止** 的：
    
    * 任何与课程教学内容无关的行为，包括且不限于用作入校连接跳板、下载或存放无关文件；
    * 任何尝试攻击集群的行为，包括且不限于非法提升权限、暴力破解密码、非正常读写磁盘；
    * 任何恶意的、违反法律法规的行为，包括且不限于发起网络攻击、运行加密货币挖矿；
    * 任何长时间抢占资源的行为，包括且不限于使用脚本循环提交大量任务、在跳板机上运行大量任务。

由于选课人数较多，为了保证同学们能够公平地分享集群资源，我们设定了一系列的资源限制，包括空间限制与任务运行限制。每个用户的 home 配额为 20GB，超出这一限制后将无法再创建或修改文件。如果有合理的需求，可以联系助教进行扩容。
